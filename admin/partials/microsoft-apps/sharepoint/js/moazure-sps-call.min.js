document.addEventListener("DOMContentLoaded",function(){function e(t,i,r){switch(t){case"defSiteLoad":console.log("in defsite load"),I.style.display="block",z.style.display="none",s();break;case"allSiteLoad":console.log("in allssite load"),S.style.display="block",A.style.display="none",a();break;case"defDriveLoad":console.log("in defdrive load"),defDriveLoad(i,r);break;case"allDriveLoad":console.log("in all drive load"),B.style.display="block",L.style.display="none",n(i,r);break;case"docLoad":console.log("in table body load"),p(),o(i,r);break;default:t="siteLoad",e(t,"","")}}function t(t){T.innerHTML="";const s=document.createElement("p");if(s.classList.add("bread-cont"),s.setAttribute("data-id",U),s.textContent=J,t||s.classList.add("bread-sel"),s.addEventListener("click",function(){e("docLoad",U,J)}),T.appendChild(s),t){const e=t.indexOf("root:/");if(-1!==e){const s=t.substring(e+"root:/".length),a=s.split("/");let n=`/drives/${U}/root:`;a&&a.forEach((e,t)=>{if(e){n+="/"+e;const s=document.createElement("span");s.className="bread-separator",s.textContent=" > ",T.appendChild(s);const o=document.createElement("p");o.classList.add("bread-cont"),o.setAttribute("data-path",n),o.textContent=decodeURIComponent(e),t===a.length-1&&o.classList.add("bread-sel"),o.addEventListener("click",function(){p(),i(o.getAttribute("data-path"))}),T.appendChild(o)}})}}}async function s(){urlSite=moazure_sps_data.url+"wp-json/login-with-azure/v1/get-site";try{let t={site_fetch:"defSite"};const s=await fetch(urlSite,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json();if(a.error){if("sharepoint"===R){let e=a.error_description.indexOf("Trace ID"),t=-1!==e?a.error_description.substring(0,e-1):a.error_description;b.innerHTML="",b.textContent=a.error+": "+t}return _.style.display="none",f.style.display="block",void("accessDenied"!==a.error&&"AccessDenied"!==a.error||(v.style.display="inherit",w.style.display="none"))}const n=a.sites,o=a.default_site;N=o.id?o.id:n[0].id,H=o.displayName?o.displayName:n[0].displayName,z.textContent=H,I.style.display="none",z.style.display="",e("allDriveLoad",N,H)}catch(e){_.style.display="none",f.style.display="block",console.error("Error fetching default site: ",e)}}async function a(){urlSite=moazure_sps_data.url+"wp-json/login-with-azure/v1/get-site";try{let t={site_fetch:"allSites"};const s=await fetch(urlSite,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json();if(a.error){if("sharepoint"===R){let e=a.error_description.indexOf("Trace ID"),t=-1!==e?a.error_description.substring(0,e-1):a.error_description;b.innerHTML="",b.textContent=a.error+" : "+t}return _.style.display="none",f.style.display="block",void("accessDenied"!==a.error&&"AccessDenied"!==a.error||(v.style.display="inherit",w.style.display="none"))}const n=a.sites;A.innerHTML="",n.forEach(t=>{const s=document.createElement("p");s.setAttribute("class","list-site"),s.textContent=t.displayName,s.addEventListener("click",function(){N=t.id,H=t.displayName,z.textContent=H,C.style.display="none",e("allDriveLoad",N,H)}),A.appendChild(s)}),S.style.display="none",A.style.display=""}catch(e){_.style.display="none",f.style.display="block",console.error("Error fetching sites: ",e)}}async function n(t,s){if(t){urlDrive=moazure_sps_data.url+"wp-json/login-with-azure/v1/get-drive";try{let a={site_id:t,site_name:s,drive_fetch:"defDrive"};const n=await fetch(urlDrive,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),o=await n.json();if(o.error){if("sharepoint"===R){let e=o.error_description.indexOf("Trace ID"),t=-1!==e?o.error_description.substring(0,e-1):o.error_description;b.innerHTML="",b.textContent=o.error+" : "+t}return _.style.display="none",f.style.display="block",void("accessDenied"!==o.error&&"AccessDenied"!==o.error||(v.style.display="inherit",w.style.display="none"))}const i=o.default_drive,r=o.drives;U=i.id?i.id:r[0].id,J=i.name?i.name:r[0].name;let d=0;console.log("all drive res: ",o),L.innerHTML="",console.log("drive dots menu inner html: ",E),E.innerHTML="",console.log("drive dots menu inner html: ",E),r.forEach((t,s)=>{if(s<4){const s=document.createElement("p");s.setAttribute("class","drive-para"),s.textContent=t.name,s.addEventListener("click",function(){U=t.id,J=t.name,e("docLoad",U,J)}),L.appendChild(s),d++}else{const s=document.createElement("p");s.setAttribute("class","drive-dots-para"),s.textContent=t.name,s.addEventListener("click",function(){U=t.id,J=t.name,E.style.display="none",e("docLoad",U,J)}),E.appendChild(s),4===d&&(k.style.display="block")}}),B.style.display="none",L.style.display="flex",e("docLoad",U,J)}catch(e){_.style.display="none",f.style.display="block",console.error("Error fetching drives:",e)}}}async function o(e,s){if(e){console.log("in doc load console"),urlDocs=moazure_sps_data.url+"wp-json/login-with-azure/v1/get-docs";try{let a={drive_id:e,drive_name:s};const n=await fetch(urlDocs,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),o=await n.json();if(console.log("documents..: ",o),o.error){if("sharepoint"===R){let e=o.error_description.indexOf("Trace ID"),t=-1!==e?o.error_description.substring(0,e-1):o.error_description;b.innerHTML="",b.textContent=o.error+" : "+t,_.style.display="none",f.style.display="block","accessDenied"!==o.error&&"AccessDenied"!==o.error||(v.style.display="inherit",w.style.display="none")}else h.style.display="none",g.style.display="block";return}t(""),c(o)}catch(e){"sharepoint"===R?(_.style.display="none",f.style.display="block"):(h.style.display="none",g.style.display="block"),console.error("Error fetching documents:",e)}}}async function i(e){if(e){urlItem=moazure_sps_data.url+"wp-json/login-with-azure/v1/get-docs-by-path";try{let s={doc_path:e};const a=await fetch(urlItem,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await a.json();if(n.error){if("sharepoint"===R){let e=n.error_description.indexOf("Trace ID"),t=-1!==e?n.error_description.substring(0,e-1):n.error_description;b.innerHTML="",b.textContent=n.error+" : "+t,_.style.display="none",f.style.display="block","accessDenied"!==n.error&&"AccessDenied"!==n.error||(v.style.display="inherit",w.style.display="none")}else h.style.display="none",g.style.display="block";return}t(e),c(n)}catch(e){"sharepoint"===R?(_.style.display="none",f.style.display="block"):(h.style.display="none",g.style.display="block"),console.error("Error fetching documents:",e)}}}function r(e,t=2){return base=Math.log(e)/Math.log(1024),suffixes=["","KB","MB","GB","TB"],Math.round(Math.pow(1024,base-Math.floor(base)),t)+" "+suffixes[Math.floor(base)]}function d(e){var t={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},s=new Date,a=(s.getFullYear(),e.split("-")),n=t[a[1]]+" "+a[2]+", "+a[0];return n}function l(e){let t=e.name.split("."),s=t[t.length-1],a=moazure_sps_data.mime_types[s],n="file";return e.folder?n="folder":a&&a.includes("image")?n="image":"doc"==s||"docx"==s||"docm"==s?n="docs":"xlw"==s||"xls"==s||"xlt"==s||"xlsm"==s||"xlsb"==s||"xltx"==s||"xltm"==s||"xlam"==s||"ods"==s||"xlsx"==s?n="excel":"pdf"==s?n="pdf":"zip"==s&&(n="zip"),n}function c(e){let t=[];e.forEach((e,s)=>{let a=l(e),n=d(e.lastModifiedDateTime.split("T")[0]),o=e.size?r(e.size,0):"0 KB",i={type:a,nameObj:{name:e.name,type:a,downloadUrl:e["@microsoft.graph.downloadUrl"],path:e.parentReference.path,webUrl:e.webUrl},lastModified:n,size:o};t.push(i)}),jQuery("#moazure_sps_table").DataTable().destroy(),jQuery("#moazure_sps_table").DataTable({data:t,columns:[{data:"type",render:function(e){let t="";switch(e){case"folder":t=moazure_sps_data.folder_icon_url;break;case"image":t=moazure_sps_data.image_icon;break;case"docs":t=moazure_sps_data.worddoc_icon;break;case"excel":t=moazure_sps_data.exceldoc_icon;break;case"pdf":t=moazure_sps_data.pdfdoc_icon;break;case"zip":t=moazure_sps_data.zip_icon;break;default:t=moazure_sps_data.file_icon}return'<div class="sps-filetype"><img src="'+t+'" alt="'+e+'" width="20px" height="20px"></div>'}},{data:"nameObj",render:function(e){const t=document.createElement("div"),s=document.createElement("div");s.classList.add("sps-docname");const a=document.createElement("div");a.classList.add("sps-imghover");const n=document.createElement("p"),o=document.createElement("img"),i=document.createElement("img");return n.classList.add("sps-filename"),n.textContent=e.name,n.setAttribute("file-type",e.type),"folder"===e.type?(n.setAttribute("sps-path",e.path),n.setAttribute("web-url",e.webUrl)):(n.setAttribute("down-url",e.downloadUrl),o.classList.add("sps-downimg"),o.src=moazure_sps_data.download,o.alt="download",o.setAttribute("down-url",e.downloadUrl),o.setAttribute("width","15px"),a.appendChild(o)),i.classList.add("sps-prewimg"),i.src=moazure_sps_data.redirect,i.alt="redirect",i.setAttribute("web-url",e.webUrl),i.setAttribute("width","15px"),a.appendChild(i),s.appendChild(n),t.appendChild(s),t.appendChild(a),""!==t.innerHTML?'<div class="sps-ncdoc moazure-flex">'+t.innerHTML+"</div>":e}},{data:"lastModified",render:function(e){return'<div class="sps-lastmod"><p class="sps-lastmod-para">'+e+"</p></div>"}},{data:"size",render:function(e){return'<div class="sps-size"><p class="sps-size-para">'+e+"</p></div>"}}],preInitComplete:function(){jQuery("#loaderRow").hide()},initComplete:function(){0==t.length&&u()}}),y()}function p(){D.innerHTML='<tr id="loaderRow" align="center"><td colspan="4"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; display: block; shape-rendering: auto; animation-play-state: running; animation-delay: 0s;" width="10%" height="10%" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><path d="M20 50A30 30 0 0 0 80 50A30 32 0 0 1 20 50" fill="#0099e5" stroke="none" style="animation-play-state: running; animation-delay: 0s;"><animateTransform attributeName="transform" type="rotate" dur="0.4s" repeatCount="indefinite" keyTimes="0;1" values="0 50 51;360 50 51" style="animation-play-state: running; animation-delay: 0s;"/></path></svg></td></tr>'}function u(){D.innerHTML='<tr><td colspan="4" align="center"><svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" enable-background="new 0 0 512 512" height="50" viewBox="0 0 512 512" width="50"><g><path d="m413.1 99.4h-153c-9.1 0-16.4-7.3-16.4-16.4s-7.3-16.4-16.4-16.4h-193.8c-5.4 0-10.4 2.6-13.5 7l-15 21.6c-1.9 2.8-2.9 6-2.9 9.4v324.4c0 9.1 7.3 16.4 16.4 16.4h394.6c9.1 0 16.4-7.3 16.4-16.4v-313.2c0-9-7.3-16.4-16.4-16.4z" fill="#379fc8"/><path d="m413.1 99.4h-153c-9.1 0-16.4-7.3-16.4-16.4s-7.3-16.4-16.4-16.4h-193.8c-5.4 0-10.4 2.6-13.5 7l-15 21.6c-1.9 2.8-2.9 6-2.9 9.4v9.6c0-3.4 1-6.6 2.9-9.4l15-21.6c3.1-4.4 8.1-7 13.5-7h193.7c9.1 0 16.4 7.3 16.4 16.4s7.4 16.4 16.5 16.4h153.1c9.1 0 16.4 7.3 16.4 16.4v-9.6c-.1-9-7.4-16.4-16.5-16.4z" fill="#41b3e2"/><path d="m493.5 173.1h-393c-7.2 0-13.5 4.6-15.6 11.5l-76 239.4c-3.4 10.6 4.5 21.4 15.6 21.4h393c7.2 0 13.5-4.6 15.6-11.5l75.9-239.5c3.5-10.5-4.4-21.3-15.5-21.3z" fill="#41b3e2"/><path d="m8.9 431.8 75.9-239.5c2.2-6.8 8.5-11.5 15.6-11.5h393c7.9 0 14.1 5.5 15.9 12.5 2.5-10.2-5.2-20.2-15.9-20.2h-393c-7.2 0-13.5 4.6-15.6 11.5l-75.9 239.4c-1 3-.9 6.1-.2 8.9.1-.4.1-.8.2-1.1z" fill="#5acef2"/></g></svg><br/><p>No items found.</p></td></tr>'}function m(){const t=document.getElementById("moazure_sps_refresh"),s=document.getElementById("refetch_sps"),a=(document.querySelectorAll(".sps-downimg"),document.querySelectorAll(".sps-prewimg"),document.querySelectorAll(".drive-para")),n=document.querySelectorAll(".drive-dots-para");"sharepoint"===R&&(x.addEventListener("click",function(){C.style.display="none"===C.style.display?"inherit":"none",E&&"none"!==E.style.display&&(E.style.display="none"),e("allSiteLoad","","")}),k&&k.addEventListener("click",function(){console.log("in dots menu: ",E.style.display),E.style.display="none"===E.style.display?"block":"none",console.log("in dots menu after: ",E.style.display),"none"!==C.style.display&&(C.style.display="none")}),document.addEventListener("click",function(e){x.contains(e.target)||C.contains(e.target)||"none"!==C.style.display&&(C.style.display="none"),k&&E&&(k.contains(e.target)||E.contains(e.target)||"none"!==E.style.display&&(E.style.display="none"))}),a.forEach(t=>{t.addEventListener("click",function(t){console.log("in drives btn"),U=t.target.id,J=t.target.textContent,e("docLoad",t.target.id,t.target.textContent)})}),n.forEach(t=>{t.addEventListener("click",function(t){console.log("in drive dots btn"),U=t.target.id,J=t.target.textContent,E.style.display="none",e("docLoad",t.target.id,t.target.textContent)})}),s.addEventListener("click",function(){_.style.display="",f.style.display="none",h.style.display="",g.style.display="none",moazure_sps_data.doc_path?(p(),i(moazure_sps_data.doc_path)):moazure_sps_data.drive_id?e("docLoad",moazure_sps_data.drive_id,moazure_sps_data.drive_name):moazure_sps_data.site_id?e("defDriveLoad",moazure_sps_data.site_id,moazure_sps_data.site_name):e("defSiteLoad","","")})),t.addEventListener("click",function(){location.reload()})}function y(){const e=document.querySelectorAll(".sps-filename"),t=document.querySelectorAll(".sps-downimg"),s=document.querySelectorAll(".sps-prewimg");e.forEach(e=>{e.addEventListener("click",function(e){const t=e.target.getAttribute("file-type");if("folder"===t){const t=e.target.getAttribute("sps-path"),s=e.target.getAttribute("web-url");if(t){const s=t+"/"+e.target.textContent;p(),i(s)}else if(s){const e=new URL(s),t=e.pathname,a=t.indexOf(`${J}`);let n=t.substring(a+`${J}`.length);n=`/drives/${U}/root:`+decodeURIComponent(n),p(),i(n)}}else window.location.href=e.target.getAttribute("down-url")})}),t.forEach(e=>{e.addEventListener("click",function(e){window.location.href=e.target.getAttribute("down-url")})}),s.forEach(e=>{e.addEventListener("click",function(e){window.open(e.target.getAttribute("web-url"),"_blank")})})}const _=document.getElementById("sharepoint_display"),f=document.getElementById("sps_admin_err"),h=document.getElementById("sps_docs"),g=document.getElementById("sps_sc_err"),b=document.getElementById("res_err"),v=document.getElementById("sps_spec_err"),w=document.getElementById("sps_gen_err"),z=document.getElementById("moazure_sps_site"),L=document.getElementById("moazure_sps_drive"),E=document.getElementById("drive_dots_menu-new"),x=document.getElementById("moazure_sps_site_toggle"),k=document.getElementById("moazure_drive_dots"),C=document.getElementById("site_menu"),A=document.getElementById("site_item"),D=document.getElementById("moazure_sps_table_body"),T=document.getElementById("moazure_sps_breadcrumb"),I=document.getElementById("defsite_loader"),S=document.getElementById("allsite_loader"),B=document.getElementById("alldrive_loader");console.log("hey there"),jQuery("#moazure_sps_table").DataTable({columns:[{title:'<div class="sps-filetype"><img src="'+moazure_sps_data.filetype_col+'" alt="file-type" width="20px" height="20px"></div>'},{title:'<div class="sps-namehead"><p class="sps-filename">Name</p></div>'},{title:'<div class="sps-modhead"><p class="sps-lastmod-para">Last Modified Date</p></div>'},{title:'<div class="sps-sizehead"><p class="sps-size-para">Size</p></div>'}]});let M=moazure_sps_data.doc_path?"docsByPath":moazure_sps_data.drive_id?"docLoad":moazure_sps_data.site_id?"allDriveLoad":"defSiteLoad",j="",O="",N=moazure_sps_data.site_id?moazure_sps_data.site_id:"",H=moazure_sps_data.site_name?moazure_sps_data.site_name:"",U=moazure_sps_data.drive_id?moazure_sps_data.drive_id:"",J=moazure_sps_data.drive_name?moazure_sps_data.drive_name:"";"allDriveLoad"===M?(j=moazure_sps_data.site_id,O=moazure_sps_data.site_name):"docLoad"===M&&(j=moazure_sps_data.drive_id,O=moazure_sps_data.drive_name);const P=new URLSearchParams(window.location.search),R=P.get("app");"sharepoint"===R?"docsByPath"===M?(p(),i(moazure_sps_data.doc_path)):e(M,j,O):e("docLoad",moazure_sps_data.drive_id,moazure_sps_data.drive_name),m()});